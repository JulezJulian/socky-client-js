/*!
 * Socky JavaScript Library
 *
 * @version 0.4.2
 * @author  Bernard Potocki <bernard.potocki@imanel.org>
 * @licence The MIT licence.
 * @source  http://github.com/socky/socky-js
 */
window.SOCKY_ASSET_LOCATION="http://js.socky.org/v0.4/assets";Socky=function(a,b,c){this.host=a;this.port=b;this.params=c;Socky.isReady?this.connect():Socky.instances.push(this)};Socky.isReady=false;Socky.instances=[];Socky.CONNECTING=0;Socky.AUTHENTICATING=1;Socky.OPEN=2;Socky.CLOSED=3;Socky.UNAUTHENTICATED=4;
Socky.prototype.connect=function(){var a=this;a.state=Socky.CONNECTING;var b=new WebSocket(this.host+":"+this.port+"/?"+this.params);b.onopen=function(){a.onopen()};b.onmessage=function(c){a.onmessage(c)};b.onclose=function(){a.onclose()};b.onerror=function(){a.onerror()}};Socky.ready=function(){Socky.isReady=true;for(var a=0;a<Socky.instances.length;a++)Socky.instances[a].state==undefined&&Socky.instances[a].connect()};Socky.prototype.onopen=function(){this.state=Socky.AUTHENTICATING;this.respond_to_connect()};
Socky.prototype.onmessage=function(a){try{var b=JSON.parse(a.data);switch(b.type){case "message":this.respond_to_message(b.body);break;case "authentication":if(b.body=="success"){this.state=Socky.OPEN;this.respond_to_authentication_success()}else{this.state=Socky.UNAUTHENTICATED;this.respond_to_authentication_failure()}}}catch(c){console.error(c.toString())}};Socky.prototype.onclose=function(){this.state!=Socky.CLOSED&&this.state!=Socky.UNAUTHENTICATED&&this.respond_to_disconnect()};
Socky.prototype.onerror=function(){};Socky.prototype.respond_to_connect=function(){};Socky.prototype.respond_to_authentication_success=function(){};Socky.prototype.respond_to_authentication_failure=function(){};Socky.prototype.respond_to_message=function(a){eval(a)};Socky.prototype.respond_to_disconnect=function(){var a=this;setTimeout(function(){a.connect()},1E3)};
var _require=function(){var a;a=document.addEventListener?function(b,c){b.addEventListener("load",c,false)}:function(b,c){b.attachEvent("onreadystatechange",function(){if(b.readyState=="loaded"||b.readyState=="complete")c()})};return function(b,c){function i(j,e){e=e||function(){};var k=document.getElementsByTagName("head")[0],d=document.createElement("script");d.setAttribute("src",j);d.setAttribute("type","text/javascript");d.setAttribute("async",true);a(d,function(){var l=e;g++;h==g&&setTimeout(l,
0)});k.appendChild(d)}for(var g=0,h=b.length,f=0;f<h;f++)i(b[f],c)}}();
(function(){var a=[],b=function(){Socky.ready()};window.JSON==undefined&&a.push(SOCKY_ASSET_LOCATION+"/json2.min.js");if(window.WebSocket==undefined){window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true;window.WEB_SOCKET_SWF_LOCATION=SOCKY_ASSET_LOCATION+"/WebSocketMain.swf";window.WEB_SOCKET_DEBUG=false;a.push(SOCKY_ASSET_LOCATION+"/flashfallback.min.js");b=function(){FABridge.addInitializationCallback("webSocket",function(){Socky.ready()});WebSocket.__initialize()}}a.length>0?_require(a,b):b()})();
