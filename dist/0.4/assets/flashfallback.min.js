/*!
 * Socky JavaScript Library
 *
 * @version 0.4.2
 * @author  Bernard Potocki <bernard.potocki@imanel.org>
 * @licence The MIT licence.
 * @source  http://github.com/socky/socky-js
 *
 * This library contains code with the following licences:
 *
 * web_socket.js:
 *
 *   Copyright: Hiroshi Ichikawa <http://gimite.net/en/>
 *   License: New BSD License
 *   Reference: http://dev.w3.org/html5/websockets/
 *   Reference: http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol
 *
 * swfobject.js:
 *
 *   SWFObject v2.2 <http://code.google.com/p/swfobject/>
 *   is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 * FABridge.js:
 *
 *   Copyright 2006 Adobe Systems Incorporated
 *
 *   Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"),
 *   to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 *   and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 *   The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 */
var swfobject=function(){function c(){if(!D){try{var a=l.getElementsByTagName("body")[0].appendChild(l.createElement("span"));a.parentNode.removeChild(a)}catch(d){return}D=true;a=K.length;for(var f=0;f<a;f++)K[f]()}}function e(a){if(D)a();else K[K.length]=a}function b(a){if(typeof u.addEventListener!=p)u.addEventListener("load",a,false);else if(typeof l.addEventListener!=p)l.addEventListener("load",a,false);else if(typeof u.attachEvent!=p)ba(u,"onload",a);else if(typeof u.onload=="function"){var d=
u.onload;u.onload=function(){d();a()}}else u.onload=a}function g(){var a=l.getElementsByTagName("body")[0],d=l.createElement(w);d.setAttribute("type",L);var f=a.appendChild(d);if(f){var h=0;(function(){if(typeof f.GetVariable!=p){var i=f.GetVariable("$version");if(i){i=i.split(" ")[1].split(",");j.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}}else if(h<10){h++;setTimeout(arguments.callee,10);return}a.removeChild(d);f=null;k()})()}else k()}function k(){var a=z.length;if(a>0)for(var d=
0;d<a;d++){var f=z[d].id,h=z[d].callbackFn,i={success:false,id:f};if(j.pv[0]>0){var n=v(f);if(n)if(M(z[d].swfVersion)&&!(j.wk&&j.wk<312)){E(f,true);if(h){i.success=true;i.ref=o(f);h(i)}}else if(z[d].expressInstall&&t()){i={};i.data=z[d].expressInstall;i.width=n.getAttribute("width")||"0";i.height=n.getAttribute("height")||"0";if(n.getAttribute("class"))i.styleclass=n.getAttribute("class");if(n.getAttribute("align"))i.align=n.getAttribute("align");var m={};n=n.getElementsByTagName("param");for(var q=
n.length,r=0;r<q;r++)if(n[r].getAttribute("name").toLowerCase()!="movie")m[n[r].getAttribute("name")]=n[r].getAttribute("value");s(i,m,f,h)}else{G(n);h&&h(i)}}else{E(f,true);if(h){if((f=o(f))&&typeof f.SetVariable!=p){i.success=true;i.ref=f}h(i)}}}}function o(a){var d=null;if((a=v(a))&&a.nodeName=="OBJECT")if(typeof a.SetVariable!=p)d=a;else if(a=a.getElementsByTagName(w)[0])d=a;return d}function t(){return!N&&M("6.0.65")&&(j.win||j.mac)&&!(j.wk&&j.wk<312)}function s(a,d,f,h){N=true;T=h||null;V={success:false,
id:f};var i=v(f);if(i){if(i.nodeName=="OBJECT"){I=F(i);O=null}else{I=i;O=f}a.id=W;if(typeof a.width==p||!/%$/.test(a.width)&&parseInt(a.width,10)<310)a.width="310";if(typeof a.height==p||!/%$/.test(a.height)&&parseInt(a.height,10)<137)a.height="137";l.title=l.title.slice(0,47)+" - Flash Player Installation";h=j.ie&&j.win?"ActiveX":"PlugIn";h="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+l.title;if(typeof d.flashvars!=p)d.flashvars+="&"+h;else d.flashvars=
h;if(j.ie&&j.win&&i.readyState!=4){h=l.createElement("div");f+="SWFObjectNew";h.setAttribute("id",f);i.parentNode.insertBefore(h,i);i.style.display="none";(function(){i.readyState==4?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)})()}A(a,d,f)}}function G(a){if(j.ie&&j.win&&a.readyState!=4){var d=l.createElement("div");a.parentNode.insertBefore(d,a);d.parentNode.replaceChild(F(a),d);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,
10)})()}else a.parentNode.replaceChild(F(a),a)}function F(a){var d=l.createElement("div");if(j.win&&j.ie)d.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(w)[0])if(a=a.childNodes)for(var f=a.length,h=0;h<f;h++)!(a[h].nodeType==1&&a[h].nodeName=="PARAM")&&a[h].nodeType!=8&&d.appendChild(a[h].cloneNode(true));return d}function A(a,d,f){var h,i=v(f);if(j.wk&&j.wk<312)return h;if(i){if(typeof a.id==p)a.id=f;if(j.ie&&j.win){var n="",m;for(m in a)if(a[m]!=Object.prototype[m])if(m.toLowerCase()==
"data")d.movie=a[m];else if(m.toLowerCase()=="styleclass")n+=' class="'+a[m]+'"';else if(m.toLowerCase()!="classid")n+=" "+m+'="'+a[m]+'"';m="";for(var q in d)if(d[q]!=Object.prototype[q])m+='<param name="'+q+'" value="'+d[q]+'" />';i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+n+">"+m+"</object>";P[P.length]=a.id;h=v(a.id)}else{q=l.createElement(w);q.setAttribute("type",L);for(var r in a)if(a[r]!=Object.prototype[r])if(r.toLowerCase()=="styleclass")q.setAttribute("class",
a[r]);else r.toLowerCase()!="classid"&&q.setAttribute(r,a[r]);for(n in d)if(d[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){a=q;m=n;r=d[n];f=l.createElement("param");f.setAttribute("name",m);f.setAttribute("value",r);a.appendChild(f)}i.parentNode.replaceChild(q,i);h=q}}return h}function X(a){var d=v(a);if(d&&d.nodeName=="OBJECT")if(j.ie&&j.win){d.style.display="none";(function(){if(d.readyState==4){var f=v(a);if(f){for(var h in f)if(typeof f[h]=="function")f[h]=null;f.parentNode.removeChild(f)}}else setTimeout(arguments.callee,
10)})()}else d.parentNode.removeChild(d)}function v(a){var d=null;try{d=l.getElementById(a)}catch(f){}return d}function ba(a,d,f){a.attachEvent(d,f);H[H.length]=[a,d,f]}function M(a){var d=j.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return d[0]>a[0]||d[0]==a[0]&&d[1]>a[1]||d[0]==a[0]&&d[1]==a[1]&&d[2]>=a[2]?true:false}function Y(a,d,f,h){if(!(j.ie&&j.mac)){var i=l.getElementsByTagName("head")[0];if(i){f=f&&typeof f=="string"?f:"screen";if(h)U=x=null;
if(!x||U!=f){h=l.createElement("style");h.setAttribute("type","text/css");h.setAttribute("media",f);x=i.appendChild(h);if(j.ie&&j.win&&typeof l.styleSheets!=p&&l.styleSheets.length>0)x=l.styleSheets[l.styleSheets.length-1];U=f}if(j.ie&&j.win)x&&typeof x.addRule==w&&x.addRule(a,d);else x&&typeof l.createTextNode!=p&&x.appendChild(l.createTextNode(a+" {"+d+"}"))}}}function E(a,d){if(Z){var f=d?"visible":"hidden";if(D&&v(a))v(a).style.visibility=f;else Y("#"+a,"visibility:"+f)}}function $(a){return/[\\\"<>\.;]/.exec(a)!=
null&&typeof encodeURIComponent!=p?encodeURIComponent(a):a}var p="undefined",w="object",L="application/x-shockwave-flash",W="SWFObjectExprInst",u=window,l=document,B=navigator,aa=false,K=[function(){aa?g():k()}],z=[],P=[],H=[],I,O,T,V,D=false,N=false,x,U,Z=true,j=function(){var a=typeof l.getElementById!=p&&typeof l.getElementsByTagName!=p&&typeof l.createElement!=p,d=B.userAgent.toLowerCase(),f=B.platform.toLowerCase(),h=f?/win/.test(f):/win/.test(d);f=f?/mac/.test(f):/mac/.test(d);d=/webkit/.test(d)?
parseFloat(d.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var i=!+"\u000b1",n=[0,0,0],m=null;if(typeof B.plugins!=p&&typeof B.plugins["Shockwave Flash"]==w){if((m=B.plugins["Shockwave Flash"].description)&&!(typeof B.mimeTypes!=p&&B.mimeTypes[L]&&!B.mimeTypes[L].enabledPlugin)){aa=true;i=false;m=m.replace(/^.*\s+(\S+\s+\S+$)/,"$1");n[0]=parseInt(m.replace(/^(.*)\..*$/,"$1"),10);n[1]=parseInt(m.replace(/^.*\.(.*)\s.*$/,"$1"),10);n[2]=/[a-zA-Z]/.test(m)?parseInt(m.replace(/^.*[a-zA-Z]+(.*)$/,
"$1"),10):0}}else if(typeof u.ActiveXObject!=p)try{var q=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(q)if(m=q.GetVariable("$version")){i=true;m=m.split(" ")[1].split(",");n=[parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],10)]}}catch(r){}return{w3:a,pv:n,wk:d,ie:i,win:h,mac:f}}();(function(){if(j.w3){if(typeof l.readyState!=p&&l.readyState=="complete"||typeof l.readyState==p&&(l.getElementsByTagName("body")[0]||l.body))c();if(!D){typeof l.addEventListener!=p&&l.addEventListener("DOMContentLoaded",
c,false);if(j.ie&&j.win){l.attachEvent("onreadystatechange",function(){if(l.readyState=="complete"){l.detachEvent("onreadystatechange",arguments.callee);c()}});u==top&&function(){if(!D){try{l.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}c()}}()}j.wk&&function(){D||(/loaded|complete/.test(l.readyState)?c():setTimeout(arguments.callee,0))}();b(c)}}})();(function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var a=H.length,d=0;d<a;d++)H[d][0].detachEvent(H[d][1],
H[d][2]);a=P.length;for(d=0;d<a;d++)X(P[d]);for(var f in j)j[f]=null;j=null;for(var h in swfobject)swfobject[h]=null;swfobject=null})})();return{registerObject:function(a,d,f,h){if(j.w3&&a&&d){var i={};i.id=a;i.swfVersion=d;i.expressInstall=f;i.callbackFn=h;z[z.length]=i;E(a,false)}else h&&h({success:false,id:a})},getObjectById:function(a){if(j.w3)return o(a)},embedSWF:function(a,d,f,h,i,n,m,q,r,J){var Q={success:false,id:d};if(j.w3&&!(j.wk&&j.wk<312)&&a&&d&&f&&h&&i){E(d,false);e(function(){f+="";
h+="";var C={};if(r&&typeof r===w)for(var y in r)C[y]=r[y];C.data=a;C.width=f;C.height=h;y={};if(q&&typeof q===w)for(var R in q)y[R]=q[R];if(m&&typeof m===w)for(var S in m)if(typeof y.flashvars!=p)y.flashvars+="&"+S+"="+m[S];else y.flashvars=S+"="+m[S];if(M(i)){R=A(C,y,d);C.id==d&&E(d,true);Q.success=true;Q.ref=R}else if(n&&t()){C.data=n;s(C,y,d,J);return}else E(d,true);J&&J(Q)})}else J&&J(Q)},switchOffAutoHideShow:function(){Z=false},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],
release:j.pv[2]}},hasFlashPlayerVersion:M,createSWF:function(a,d,f){if(j.w3)return A(a,d,f)},showExpressInstall:function(a,d,f,h){j.w3&&t()&&s(a,d,f,h)},removeSWF:function(a){j.w3&&X(a)},createCSS:function(a,d,f,h){j.w3&&Y(a,d,f,h)},addDomLoadEvent:e,addLoadEvent:b,getQueryParamValue:function(a){var d=l.location.search||l.location.hash;if(d){if(/\?/.test(d))d=d.split("?")[1];if(a==null)return $(d);d=d.split("&");for(var f=0;f<d.length;f++)if(d[f].substring(0,d[f].indexOf("="))==a)return $(d[f].substring(d[f].indexOf("=")+
1))}return""},expressInstallCallback:function(){if(N){var a=v(W);if(a&&I){a.parentNode.replaceChild(I,a);if(O){E(O,true);if(j.ie&&j.win)I.style.display="block"}T&&T(V)}N=false}}}}();function FABridge(c,e){this.target=c;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=FABridge.nextBridgeID++;this.name=e;this.nextLocalFuncID=0;FABridge.instances[this.name]=this;FABridge.idMap[this.bridgeID]=this;return this}
FABridge.TYPE_ASINSTANCE=1;FABridge.TYPE_ASFUNCTION=2;FABridge.TYPE_JSFUNCTION=3;FABridge.TYPE_ANONYMOUS=4;FABridge.initCallbacks={};FABridge.userTypes={};FABridge.addToUserTypes=function(){for(var c=0;c<arguments.length;c++)FABridge.userTypes[arguments[c]]={typeName:arguments[c],enriched:false}};FABridge.argsToArray=function(c){for(var e=[],b=0;b<c.length;b++)e[b]=c[b];return e};function instanceFactory(c){this.fb_instance_id=c;return this}
function FABridge__invokeJSFunction(c){var e=c[0];c=c.concat();c.shift();return FABridge.extractBridgeFromID(e).invokeLocalFunction(e,c)}FABridge.addInitializationCallback=function(c,e){var b=FABridge.instances[c];if(b!=undefined)e.call(b);else{b=FABridge.initCallbacks[c];if(b==null)FABridge.initCallbacks[c]=b=[];b.push(e)}};
function FABridge__bridgeInitialized(c){var e=document.getElementsByTagName("object"),b=e.length,g=[];if(b>0)for(var k=0;k<b;k++)if(typeof e[k].SetVariable!="undefined")g[g.length]=e[k];b=document.getElementsByTagName("embed");k=b.length;e=[];if(k>0)for(var o=0;o<k;o++)if(typeof b[o].SetVariable!="undefined")e[e.length]=b[o];o=g.length;b=e.length;k="bridgeName="+c;if(o==1&&!b||o==1&&b==1)FABridge.attachBridge(g[0],c);else if(b==1&&!o)FABridge.attachBridge(e[0],c);else{var t=false;if(o>1)for(var s=
0;s<o;s++){for(var G=g[s].childNodes,F=0;F<G.length;F++){var A=G[F];if(A.nodeType==1&&A.tagName.toLowerCase()=="param"&&A.name.toLowerCase()=="flashvars"&&A.value.indexOf(k)>=0){FABridge.attachBridge(g[s],c);t=true;break}}if(t)break}if(!t&&b>1)for(g=0;g<b;g++)if(e[g].attributes.getNamedItem("flashVars").nodeValue.indexOf(k)>=0){FABridge.attachBridge(e[g],c);break}}return true}FABridge.nextBridgeID=0;FABridge.instances={};FABridge.idMap={};FABridge.refCount=0;
FABridge.extractBridgeFromID=function(c){return FABridge.idMap[c>>16]};FABridge.attachBridge=function(c,e){var b=new FABridge(c,e);FABridge[e]=b;var g=FABridge.initCallbacks[e];if(g!=null){for(var k=0;k<g.length;k++)g[k].call(b);delete FABridge.initCallbacks[e]}};FABridge.blockedMethods={toString:true,get:true,set:true,call:true};
FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(c){return typeof c!="object"?false:this.target.releaseNamedASObject(c.fb_instance_id)},create:function(c){return this.deserialize(this.target.create(c))},makeID:function(c){return(this.bridgeID<<16)+c},getPropertyFromAS:function(c,e){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{FABridge.refCount++;retVal=this.target.getPropFromAS(c,e);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},setPropertyInAS:function(c,e,b){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{FABridge.refCount++;retVal=this.target.setPropInAS(c,e,this.serialize(b));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},
callASFunction:function(c,e){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{FABridge.refCount++;retVal=this.target.invokeASFunction(c,this.serialize(e));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},callASMethod:function(c,e,b){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{FABridge.refCount++;b=this.serialize(b);retVal=this.target.invokeASMethod(c,e,b);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},invokeLocalFunction:function(c,e){var b,g=this.localFunctionCache[c];if(g!=undefined)b=this.serialize(g.apply(null,this.deserialize(e)));return b},getTypeFromName:function(c){return this.remoteTypeCache[c]},createProxy:function(c,e){var b=this.getTypeFromName(e);instanceFactory.prototype=b;b=new instanceFactory(c);return this.remoteInstanceCache[c]=
b},getProxy:function(c){return this.remoteInstanceCache[c]},addTypeDataToCache:function(c){for(var e=new ASProxy(this,c.name),b=c.accessors,g=0;g<b.length;g++)this.addPropertyToType(e,b[g]);c=c.methods;for(g=0;g<c.length;g++)FABridge.blockedMethods[c[g]]==undefined&&this.addMethodToType(e,c[g]);return this.remoteTypeCache[e.typeName]=e},addPropertyToType:function(c,e){var b=e.charAt(0),g;if(b>="a"&&b<="z"){g="get"+b.toUpperCase()+e.substr(1);b="set"+b.toUpperCase()+e.substr(1)}else{g="get"+e;b="set"+
e}c[b]=function(k){this.bridge.setPropertyInAS(this.fb_instance_id,e,k)};c[g]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,e))}},addMethodToType:function(c,e){c[e]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,e,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(c){var e=this;if(this.remoteFunctionCache[c]==null)this.remoteFunctionCache[c]=function(){e.callASFunction(c,FABridge.argsToArray(arguments))};
return this.remoteFunctionCache[c]},getFunctionID:function(c){if(c.__bridge_id__==undefined){c.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[c.__bridge_id__]=c}return c.__bridge_id__},serialize:function(c){var e={},b=typeof c;if(b=="number"||b=="string"||b=="boolean"||b==null||b==undefined)e=c;else if(c instanceof Array){e=[];for(b=0;b<c.length;b++)e[b]=this.serialize(c[b])}else if(b=="function"){e.type=FABridge.TYPE_JSFUNCTION;e.value=this.getFunctionID(c)}else if(c instanceof
ASProxy){e.type=FABridge.TYPE_ASINSTANCE;e.value=c.fb_instance_id}else{e.type=FABridge.TYPE_ANONYMOUS;e.value=c}return e},deserialize:function(c){var e,b=typeof c;if(b=="number"||b=="string"||b=="boolean"||c==null||c==undefined)e=this.handleError(c);else if(c instanceof Array){e=[];for(b=0;b<c.length;b++)e[b]=this.deserialize(c[b])}else if(b=="object"){for(b=0;b<c.newTypes.length;b++)this.addTypeDataToCache(c.newTypes[b]);for(var g in c.newRefs)this.createProxy(g,c.newRefs[g]);if(c.type==FABridge.TYPE_PRIMITIVE)e=
c.value;else if(c.type==FABridge.TYPE_ASFUNCTION)e=this.getFunctionProxy(c.value);else if(c.type==FABridge.TYPE_ASINSTANCE)e=this.getProxy(c.value);else if(c.type==FABridge.TYPE_ANONYMOUS)e=c.value}return e},addRef:function(c){this.target.incRef(c.fb_instance_id)},release:function(c){this.target.releaseRef(c.fb_instance_id)},handleError:function(c){if(typeof c=="string"&&c.indexOf("__FLASHERROR")==0){c=c.split("||");FABridge.refCount>0&&FABridge.refCount--;throw Error(c[1]);}return c}};
ASProxy=function(c,e){this.bridge=c;this.typeName=e;return this};ASProxy.prototype={get:function(c){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,c))},set:function(c,e){this.bridge.setPropertyInAS(this.fb_instance_id,c,e)},call:function(c,e){this.bridge.callASMethod(this.fb_instance_id,c,e)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};
(function(){function c(){}if(!window.WebSocket){var e=window.console;if(!e||!e.log||!e.error)e={log:function(){},error:function(){}};if(swfobject.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(b,g,k,o,t){var s=this;s.readyState=WebSocket.CONNECTING;s.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){s.__createFlash(b,
g,k,o,t)})},0)};WebSocket.prototype.__createFlash=function(b,g,k,o,t){var s=this;s.__flash=WebSocket.__flash.create(b,g,k||null,o||0,t||null);s.__flash.addEventListener("event",function(){setTimeout(function(){s.__handleEvents()},0)})};WebSocket.prototype.send=function(b){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";b=this.__flash.send(encodeURIComponent(b));if(b<0)return true;else{this.bufferedAmount+=b;return false}};
WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(b,g){if(!("__events"in this))this.__events={};if(!(b in this.__events)){this.__events[b]=[];if("function"==typeof this["on"+b]){this.__events[b].defaultHandler=this["on"+b];this["on"+b]=
this.__createEventHandler(this,b)}}this.__events[b].push(g)};WebSocket.prototype.removeEventListener=function(b,g){if(!("__events"in this))this.__events={};if(b in this.__events)for(var k=this.__events.length;k>-1;--k)if(g===this.__events[b][k]){this.__events[b].splice(k,1);break}};WebSocket.prototype.dispatchEvent=function(b){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(b.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var g=0,k=this.__events[b.type].length;g<k;++g){this.__events[b.type][g](b);
if(b.cancelBubble)break}false!==b.returnValue&&"function"==typeof this.__events[b.type].defaultHandler&&this.__events[b.type].defaultHandler(b)};WebSocket.prototype.__handleEvents=function(){for(var b=this.__flash.receiveEvents(),g=0;g<b.length;g++)try{var k=b[g];if("readyState"in k)this.readyState=k.readyState;if(k.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera){var o=this;this.__timer=setInterval(function(){o.__handleEvents()},500)}if(this.onopen)this.onopen()}else if(k.type==
"close"){this.__timer&&clearInterval(this.__timer);if(this.onclose)this.onclose()}else if(k.type=="message"){if(this.onmessage){var t=decodeURIComponent(k.data),s;if(window.MessageEvent&&!window.opera){s=document.createEvent("MessageEvent");s.initMessageEvent("message",false,false,t,null,null,window,null)}else s={data:t};this.onmessage(s)}}else if(k.type=="error"){this.__timer&&clearInterval(this.__timer);if(this.onerror)this.onerror()}else throw"unknown event type: "+k.type;}catch(G){e.error(G.toString())}};
WebSocket.prototype.__createEventHandler=function(b,g){return function(k){var o=new c;o.initEvent(g,true,true);o.target=o.currentTarget=b;for(var t in k)o[t]=k[t];b.dispatchEvent(o,arguments)}};c.prototype.cancelable=true;c.prototype.cancelBubble=false;c.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};c.prototype.stopPropagation=function(){this.cancelBubble=true};c.prototype.initEvent=function(b,g,k){this.type=b;this.cancelable=k;this.timeStamp=new Date};WebSocket.CONNECTING=
0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(b){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(b)})};WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";if(WebSocket.__isFlashLite()){b.style.left="0px";b.style.top="0px"}else{b.style.left=
"-100px";b.style.top="-100px"}var g=document.createElement("div");g.id="webSocketFlash";b.appendChild(g);document.body.appendChild(b);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(k){k.success||e.error("[WebSocket] swfobject.embedSWF failed")});FABridge.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=FABridge.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);
WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var k=0;k<WebSocket.__tasks.length;++k)WebSocket.__tasks[k]();WebSocket.__tasks=[]}catch(o){e.error("[WebSocket] "+o.toString())}})}else e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};WebSocket.__addTask=function(b){WebSocket.__flash?b():WebSocket.__tasks.push(b)};WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var b=window.navigator.mimeTypes["application/x-shockwave-flash"];
if(!b||!b.enabledPlugin||!b.enabledPlugin.filename)return false;return b.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(b){e.log(decodeURIComponent(b))};window.webSocketError=function(b){e.error(decodeURIComponent(b))};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else e.error("Flash Player is not installed.")}})();
