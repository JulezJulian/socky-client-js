/*!
 * Socky JavaScript Library
 *
 * @version 0.5.0-beta1
 * @author  Bernard Potocki <bernard.potocki@imanel.org>
 * @author  Stefano Verna <stefano.verna@welaika.com>
 * @licence The MIT licence.
 * @source  http://github.com/socky/socky-js
 */
/*!
 * This library contains code with the following licences:
 *
 * web_socket.js:
 *
 *   Copyright: Hiroshi Ichikawa <http://gimite.net/en/>
 *   License: New BSD License
 *   Reference: http://dev.w3.org/html5/websockets/
 *   Reference: http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol
 *
 * swfobject.js:
 *
 *   SWFObject v2.2 <http://code.google.com/p/swfobject/>
 *   is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */

var swfobject=function(){function j(){if(!x){try{var b=d.getElementsByTagName("body")[0].appendChild(d.createElement("span"));b.parentNode.removeChild(b)}catch(c){return}x=!0;b=C.length;for(var h=0;h<b;h++)C[h]()}}function a(b){x?b():C[C.length]=b}function f(b){if(typeof n.addEventListener!=k)n.addEventListener("load",b,!1);else if(typeof d.addEventListener!=k)d.addEventListener("load",b,!1);else if(typeof n.attachEvent!=k)U(n,"onload",b);else if(typeof n.onload=="function"){var c=n.onload;n.onload=
function(){c();b()}}else n.onload=b}function u(){var b=d.getElementsByTagName("body")[0],c=d.createElement(s);c.setAttribute("type",D);var h=b.appendChild(c);if(h){var a=0;(function(){if(typeof h.GetVariable!=k){var g=h.GetVariable("$version");if(g)g=g.split(" ")[1].split(","),e.pv=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}else if(a<10){a++;setTimeout(arguments.callee,10);return}b.removeChild(c);h=null;o()})()}else o()}function o(){var b=v.length;if(b>0)for(var c=0;c<b;c++){var h=v[c].id,
a=v[c].callbackFn,g={success:!1,id:h};if(e.pv[0]>0){var d=r(h);if(d)if(E(v[c].swfVersion)&&!(e.wk&&e.wk<312)){if(y(h,!0),a)g.success=!0,g.ref=A(h),a(g)}else if(v[c].expressInstall&&q()){g={};g.data=v[c].expressInstall;g.width=d.getAttribute("width")||"0";g.height=d.getAttribute("height")||"0";if(d.getAttribute("class"))g.styleclass=d.getAttribute("class");if(d.getAttribute("align"))g.align=d.getAttribute("align");var i={};d=d.getElementsByTagName("param");for(var f=d.length,l=0;l<f;l++)d[l].getAttribute("name").toLowerCase()!=
"movie"&&(i[d[l].getAttribute("name")]=d[l].getAttribute("value"));I(g,i,h,a)}else V(d),a&&a(g)}else if(y(h,!0),a){if((h=A(h))&&typeof h.SetVariable!=k)g.success=!0,g.ref=h;a(g)}}}function A(b){var c=null;if((b=r(b))&&b.nodeName=="OBJECT")typeof b.SetVariable!=k?c=b:(b=b.getElementsByTagName(s)[0])&&(c=b);return c}function q(){return!F&&E("6.0.65")&&(e.win||e.mac)&&!(e.wk&&e.wk<312)}function I(b,c,h,a){F=!0;J=a||null;N={success:!1,id:h};var g=r(h);if(g){g.nodeName=="OBJECT"?(B=K(g),G=null):(B=g,G=
h);b.id=O;if(typeof b.width==k||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==k||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";d.title=d.title.slice(0,47)+" - Flash Player Installation";a=e.ie&&e.win?"ActiveX":"PlugIn";a="MMredirectURL="+n.location.toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+d.title;typeof c.flashvars!=k?c.flashvars+="&"+a:c.flashvars=a;if(e.ie&&e.win&&g.readyState!=4)a=d.createElement("div"),h+="SWFObjectNew",
a.setAttribute("id",h),g.parentNode.insertBefore(a,g),g.style.display="none",function(){g.readyState==4?g.parentNode.removeChild(g):setTimeout(arguments.callee,10)}();L(b,c,h)}}function V(b){if(e.ie&&e.win&&b.readyState!=4){var c=d.createElement("div");b.parentNode.insertBefore(c,b);c.parentNode.replaceChild(K(b),c);b.style.display="none";(function(){b.readyState==4?b.parentNode.removeChild(b):setTimeout(arguments.callee,10)})()}else b.parentNode.replaceChild(K(b),b)}function K(b){var c=d.createElement("div");
if(e.win&&e.ie)c.innerHTML=b.innerHTML;else if(b=b.getElementsByTagName(s)[0])if(b=b.childNodes)for(var a=b.length,p=0;p<a;p++)!(b[p].nodeType==1&&b[p].nodeName=="PARAM")&&b[p].nodeType!=8&&c.appendChild(b[p].cloneNode(!0));return c}function L(b,c,a){var p,g=r(a);if(e.wk&&e.wk<312)return p;if(g){if(typeof b.id==k)b.id=a;if(e.ie&&e.win){var f="",i;for(i in b)if(b[i]!=Object.prototype[i])i.toLowerCase()=="data"?c.movie=b[i]:i.toLowerCase()=="styleclass"?f+=' class="'+b[i]+'"':i.toLowerCase()!="classid"&&
(f+=" "+i+'="'+b[i]+'"');i="";for(var m in c)c[m]!=Object.prototype[m]&&(i+='<param name="'+m+'" value="'+c[m]+'" />');g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+i+"</object>";H[H.length]=b.id;p=r(b.id)}else{m=d.createElement(s);m.setAttribute("type",D);for(var l in b)b[l]!=Object.prototype[l]&&(l.toLowerCase()=="styleclass"?m.setAttribute("class",b[l]):l.toLowerCase()!="classid"&&m.setAttribute(l,b[l]));for(f in c)c[f]!=Object.prototype[f]&&f.toLowerCase()!=
"movie"&&(b=m,i=f,l=c[f],a=d.createElement("param"),a.setAttribute("name",i),a.setAttribute("value",l),b.appendChild(a));g.parentNode.replaceChild(m,g);p=m}}return p}function P(b){var c=r(b);if(c&&c.nodeName=="OBJECT")e.ie&&e.win?(c.style.display="none",function(){if(c.readyState==4){var a=r(b);if(a){for(var d in a)typeof a[d]=="function"&&(a[d]=null);a.parentNode.removeChild(a)}}else setTimeout(arguments.callee,10)}()):c.parentNode.removeChild(c)}function r(b){var c=null;try{c=d.getElementById(b)}catch(a){}return c}
function U(b,c,a){b.attachEvent(c,a);z[z.length]=[b,c,a]}function E(b){var a=e.pv;b=b.split(".");b[0]=parseInt(b[0],10);b[1]=parseInt(b[1],10)||0;b[2]=parseInt(b[2],10)||0;return a[0]>b[0]||a[0]==b[0]&&a[1]>b[1]||a[0]==b[0]&&a[1]==b[1]&&a[2]>=b[2]?!0:!1}function Q(b,a,h,f){if(!e.ie||!e.mac){var g=d.getElementsByTagName("head")[0];if(g){h=h&&typeof h=="string"?h:"screen";f&&(M=t=null);if(!t||M!=h)f=d.createElement("style"),f.setAttribute("type","text/css"),f.setAttribute("media",h),t=g.appendChild(f),
e.ie&&e.win&&typeof d.styleSheets!=k&&d.styleSheets.length>0&&(t=d.styleSheets[d.styleSheets.length-1]),M=h;e.ie&&e.win?t&&typeof t.addRule==s&&t.addRule(b,a):t&&typeof d.createTextNode!=k&&t.appendChild(d.createTextNode(b+" {"+a+"}"))}}}function y(b,a){if(R){var h=a?"visible":"hidden";x&&r(b)?r(b).style.visibility=h:Q("#"+b,"visibility:"+h)}}function S(b){return/[\\\"<>\.;]/.exec(b)!=null&&typeof encodeURIComponent!=k?encodeURIComponent(b):b}var k="undefined",s="object",D="application/x-shockwave-flash",
O="SWFObjectExprInst",n=window,d=document,w=navigator,T=!1,C=[function(){T?u():o()}],v=[],H=[],z=[],B,G,J,N,x=!1,F=!1,t,M,R=!0,e=function(){var b=typeof d.getElementById!=k&&typeof d.getElementsByTagName!=k&&typeof d.createElement!=k,a=w.userAgent.toLowerCase(),h=w.platform.toLowerCase(),e=h?/win/.test(h):/win/.test(a);h=h?/mac/.test(h):/mac/.test(a);a=/webkit/.test(a)?parseFloat(a.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1;var g=!1,f=[0,0,0],i=null;if(typeof w.plugins!=k&&typeof w.plugins["Shockwave Flash"]==
s){if((i=w.plugins["Shockwave Flash"].description)&&!(typeof w.mimeTypes!=k&&w.mimeTypes[D]&&!w.mimeTypes[D].enabledPlugin))T=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof n.ActiveXObject!=k)try{var m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(m&&(i=m.GetVariable("$version")))g=!0,i=i.split(" ")[1].split(","),
f=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}catch(l){}return{w3:b,pv:f,wk:a,ie:g,win:e,mac:h}}();(function(){e.w3&&((typeof d.readyState!=k&&d.readyState=="complete"||typeof d.readyState==k&&(d.getElementsByTagName("body")[0]||d.body))&&j(),x||(typeof d.addEventListener!=k&&d.addEventListener("DOMContentLoaded",j,!1),e.ie&&e.win&&(d.attachEvent("onreadystatechange",function(){d.readyState=="complete"&&(d.detachEvent("onreadystatechange",arguments.callee),j())}),n==top&&function(){if(!x){try{d.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}j()}}()),e.wk&&function(){x||(/loaded|complete/.test(d.readyState)?j():setTimeout(arguments.callee,0))}(),f(j)))})();(function(){e.ie&&e.win&&window.attachEvent("onunload",function(){for(var b=z.length,a=0;a<b;a++)z[a][0].detachEvent(z[a][1],z[a][2]);b=H.length;for(a=0;a<b;a++)P(H[a]);for(var h in e)e[h]=null;e=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(b,a,h,d){if(e.w3&&b&&a){var g={};g.id=b;g.swfVersion=a;g.expressInstall=h;g.callbackFn=
d;v[v.length]=g;y(b,!1)}else d&&d({success:!1,id:b})},getObjectById:function(a){if(e.w3)return A(a)},embedSWF:function(b,c,h,d,g,f,i,m,l,j){var u={success:!1,id:c};e.w3&&!(e.wk&&e.wk<312)&&b&&c&&h&&d&&g?(y(c,!1),a(function(){h+="";d+="";var a={};if(l&&typeof l===s)for(var e in l)a[e]=l[e];a.data=b;a.width=h;a.height=d;e={};if(m&&typeof m===s)for(var n in m)e[n]=m[n];if(i&&typeof i===s)for(var o in i)typeof e.flashvars!=k?e.flashvars+="&"+o+"="+i[o]:e.flashvars=o+"="+i[o];if(E(g))n=L(a,e,c),a.id==
c&&y(c,!0),u.success=!0,u.ref=n;else if(f&&q()){a.data=f;I(a,e,c,j);return}else y(c,!0);j&&j(u)})):j&&j(u)},switchOffAutoHideShow:function(){R=!1},ua:e,getFlashPlayerVersion:function(){return{major:e.pv[0],minor:e.pv[1],release:e.pv[2]}},hasFlashPlayerVersion:E,createSWF:function(a,c,d){if(e.w3)return L(a,c,d)},showExpressInstall:function(a,c,d,f){e.w3&&q()&&I(a,c,d,f)},removeSWF:function(a){e.w3&&P(a)},createCSS:function(a,c,d,f){e.w3&&Q(a,c,d,f)},addDomLoadEvent:a,addLoadEvent:f,getQueryParamValue:function(a){var c=
d.location.search||d.location.hash;if(c){/\?/.test(c)&&(c=c.split("?")[1]);if(a==null)return S(c);c=c.split("&");for(var e=0;e<c.length;e++)if(c[e].substring(0,c[e].indexOf("="))==a)return S(c[e].substring(c[e].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var a=r(O);if(a&&B){a.parentNode.replaceChild(B,a);if(G&&(y(G,!0),e.ie&&e.win))B.style.display="block";J&&J(N)}F=!1}}}}();
(function(){if(!window.WebSocket){var j=window.console;if(!j||!j.log||!j.error)j={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?(location.protocol=="file:"&&j.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,f,j,o,A){var q=this;q.__id=WebSocket.__nextId++;WebSocket.__instances[q.__id]=q;q.readyState=WebSocket.CONNECTING;q.bufferedAmount=
0;q.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(q.__id,a,f,j||null,o||0,A||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));return a<0?!0:(this.bufferedAmount+=a,!1)},WebSocket.prototype.close=function(){if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING))this.readyState=
WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(a,f){a in this.__events||(this.__events[a]=[]);this.__events[a].push(f)},WebSocket.prototype.removeEventListener=function(a,f){if(a in this.__events)for(var j=this.__events[a],o=j.length-1;o>=0;--o)if(j[o]===f){j.splice(o,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var f=this.__events[a.type]||[],j=0;j<f.length;++j)f[j](a);(f=this["on"+a.type])&&f(a)},WebSocket.prototype.__handleEvent=
function(a){if("readyState"in a)this.readyState=a.readyState;if(a.type=="open"||a.type=="error")a=this.__createSimpleEvent(a.type);else if(a.type=="close")a=this.__createSimpleEvent("close");else if(a.type=="message")a=this.__createMessageEvent("message",decodeURIComponent(a.message));else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(window.Event){var f=document.createEvent("Event");f.initEvent(a,!1,!1);return f}else return{type:a,
bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,f){if(window.MessageEvent&&!window.opera){var j=document.createEvent("MessageEvent");j.initMessageEvent("message",!1,!1,f,null,null,window,null);return j}else return{type:a,data:f,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},
WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var f=document.createElement("div");f.id="webSocketFlash";a.appendChild(f);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,
"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||j.error("[WebSocket] swfobject.embedSWF failed")})}else j.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=
0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),f=0;f<a.length;++f)WebSocket.__instances[a[f].webSocketId].__handleEvent(a[f])}catch(u){j.error(u)}},0);return!0},WebSocket.__log=function(a){j.log(decodeURIComponent(a))},WebSocket.__error=function(a){j.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},
WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!a||!a.enabledPlugin||!a.enabledPlugin.filename)return!1;return a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):j.error("Flash Player >= 10.0.0 is required.")}})();
